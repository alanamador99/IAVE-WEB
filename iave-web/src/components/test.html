<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejemplo API de Ruteo INEGI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: bisque;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        h2 {
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }

        button {
            background-color: #3498db;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button:hover {
            background-color: #2980b9;
        }

        .result {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }

        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            background: none;
            margin-right: 0;
        }

        .tab.active {
            border-bottom: 2px solid #3498db;
            color: #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .vehicle-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            font-size: 12px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .code-example {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            margin: 15px 0;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <h1>üó∫Ô∏è Ejemplo de API de Ruteo INEGI</h1>

    <div class="warning">
        <strong>‚ö†Ô∏è Nota:</strong> Para usar esta API necesitas registrarte en
        <a href="https://gaia.inegi.org.mx/sakbe_v3.1/genera_token.jsp" target="_blank">
            https://gaia.inegi.org.mx/sakbe_v3.1/genera_token.jsp
        </a>
        y obtener tu token personal.
    </div>

    <div class="container">
        <div class="form-group">
            <label for="token">Token de API (obligatorio):</label>
            <input type="text" id="token" placeholder="Ingresa tu token de 36 caracteres" maxlength="36">
        </div>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="showTab('search-destinations')">Buscar Destinos</button>
            <button class="tab" onclick="showTab('search-lines')">Buscar L√≠neas</button>
            <button class="tab" onclick="showTab('calculate-route')">Calcular Ruta</button>
            <button class="tab" onclick="showTab('fuel-prices')">Precios Combustible</button>
            <button class="tab" onclick="showTab('code-examples')">Ejemplos de C√≥digo</button>
        </div>

        <!-- B√∫squeda de Destinos -->
        <div id="search-destinations" class="tab-content active">
            <h2>üîç B√∫squeda de Destinos</h2>
            <div class="form-group">
                <label for="searchDestination">Buscar destino:</label>
                <input type="text" id="searchDestination" placeholder="Ej: Guadalajara, Jalisco">
            </div>
            <div class="form-group">
                <label for="numResults">N√∫mero de resultados:</label>
                <input type="number" id="numResults" value="10" min="1" max="50">
            </div>
            <button onclick="searchDestinations()">Buscar Destinos</button>
            <div id="destinationResult" class="result" style="display:none;"></div>
        </div>

        <!-- B√∫squeda de L√≠neas -->
        <div id="search-lines" class="tab-content">
            <h2>üõ£Ô∏è B√∫squeda de L√≠neas</h2>
            <div class="form-group">
                <label for="longitude">Longitud (X):</label>
                <input type="number" id="longitude" placeholder="-99.1332" step="any">
            </div>
            <div class="form-group">
                <label for="latitude">Latitud (Y):</label>
                <input type="number" id="latitude" placeholder="19.4326" step="any">
            </div>
            <div class="form-group">
                <label for="scale">Escala:</label>
                <input type="number" id="scale" value="10000">
            </div>
            <button onclick="searchLines()">Buscar L√≠nea Cercana</button>
            <div id="lineResult" class="result" style="display:none;"></div>
        </div>

        <!-- C√°lculo de Rutas -->
        <div id="calculate-route" class="tab-content">
            <h2>üöó C√°lculo de Rutas</h2>

            <div class="vehicle-types">
                <div><strong>Tipos de Veh√≠culo:</strong></div>
                <div>0: Motocicleta</div>
                <div>1: Autom√≥vil</div>
                <div>2: Autob√∫s 2 ejes</div>
                <div>3: Autob√∫s 3 ejes</div>
                <div>4: Autob√∫s 4 ejes</div>
                <div>5: Cami√≥n 2 ejes</div>
                <div>6: Cami√≥n 3 ejes</div>
                <div>7: Cami√≥n 4 ejes</div>
                <div>8: Cami√≥n 5 ejes</div>
                <div>9: Cami√≥n 6 ejes</div>
                <div>10: Cami√≥n 7 ejes</div>
                <div>11: Cami√≥n 8 ejes</div>
                <div>12: Cami√≥n 9 ejes</div>
            </div>

            <div class="form-group">
                <label for="originDestId">ID Destino Origen:</label>
                <input type="number" id="originDestId" placeholder="Obten este ID de 'Buscar Destinos'">
            </div>
            <div class="form-group">
                <label for="finalDestId">ID Destino Final:</label>
                <input type="number" id="finalDestId" placeholder="Obten este ID de 'Buscar Destinos'">
            </div>
            <div class="form-group">
                <label for="vehicleType">Tipo de Veh√≠culo:</label>
                <select id="vehicleType">
                    <option value="0">Motocicleta</option>
                    <option value="1" selected>Autom√≥vil</option>
                    <option value="2">Autob√∫s 2 ejes</option>
                    <option value="5">Cami√≥n 2 ejes</option>
                </select>
            </div>
            <div class="form-group">
                <label for="excessAxles">Ejes Excedentes:</label>
                <input type="number" id="excessAxles" value="0" min="0" max="5">
            </div>
            <div class="form-group">
                <label for="barriers">Barreras (IDs separados por comas, opcional):</label>
                <input type="text" id="barriers" placeholder="12865,3659,658">
            </div>

            <button onclick="calculateRoute('optima')">Ruta √ìptima</button>
            <button onclick="calculateRoute('cuota')">Preferente Cuota</button>
            <button onclick="calculateRoute('libre')">Preferente Libre</button>
            <button onclick="getRouteDetails('detalle_c')">Detalle √ìptima</button>
            <button onclick="getRouteDetails('detalle_l')">Detalle Libre</button>

            <div id="routeResult" class="result" style="display:none;"></div>
        </div>

        <!-- Precios de Combustible -->
        <div id="fuel-prices" class="tab-content">
            <h2>‚õΩ Precios de Combustible</h2>
            <p>Consulta los precios promedio nacionales de combustibles:</p>
            <button onclick="getFuelPrices()">Obtener Precios</button>
            <div id="fuelResult" class="result" style="display:none;"></div>
        </div>

        <!-- Ejemplos de C√≥digo -->
        <div id="code-examples" class="tab-content">
            <h2>üíª Ejemplos de C√≥digo</h2>

            <h3>JavaScript con Fetch API:</h3>
            <div class="code-example">
                // Ejemplo: Buscar destinos
                async function buscarDestinos(termino, token) {
                const response = await fetch('https://gaia.inegi.org.mx/sakbe_v3.1/buscadestino', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                buscar: termino,
                type: 'json',
                num: 10,
                key: token
                })
                });

                const data = await response.json();
                return data;
                }

                // Ejemplo: Calcular ruta √≥ptima
                async function calcularRuta(origenId, destinoId, vehiculo, token) {
                const response = await fetch('https://gaia.inegi.org.mx/sakbe_v3.1/optima', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                dest_i: origenId,
                dest_f: destinoId,
                v: vehiculo,
                type: 'json',
                key: token
                })
                });

                const data = await response.json();
                return data;
                }
            </div>

            <h3>jQuery:</h3>
            <div class="code-example">
                // Buscar destinos con jQuery
                $.post('https://gaia.inegi.org.mx/sakbe_v3.1/buscadestino', {
                buscar: 'Guadalajara',
                type: 'json',
                num: 15,
                key: 'tu-token-aqui'
                }, function(data) {
                console.log(data);
                });

                // Calcular ruta
                $.post('https://gaia.inegi.org.mx/sakbe_v3.1/optima', {
                dest_i: 3345,
                dest_f: 222,
                v: 1,
                type: 'json',
                key: 'tu-token-aqui'
                }, function(data) {
                console.log('Distancia: ' + data.data.long_km + ' km');
                console.log('Tiempo: ' + data.data.tiempo_min + ' minutos');
                console.log('Costo casetas: $' + data.data.costo_caseta);
                });
            </div>

            <h3>Python con requests:</h3>
            <div class="code-example">
                import requests

                def buscar_destinos(termino, token):
                url = 'https://gaia.inegi.org.mx/sakbe_v3.1/buscadestino'
                data = {
                'buscar': termino,
                'type': 'json',
                'num': 10,
                'key': token
                }
                response = requests.post(url, data=data)
                return response.json()

                def calcular_ruta(origen_id, destino_id, vehiculo, token):
                url = 'https://gaia.inegi.org.mx/sakbe_v3.1/optima'
                data = {
                'dest_i': origen_id,
                'dest_f': destino_id,
                'v': vehiculo,
                'type': 'json',
                'key': token
                }
                response = requests.post(url, data=data)
                return response.json()

                # Uso
                token = 'tu-token-de-36-caracteres'
                destinos = buscar_destinos('Mexico', token)
                print(destinos)
            </div>
        </div>
    </div>

    <script>
        function showTab(tabId) {
            // Ocultar todos los contenidos
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));

            // Remover clase activa de todas las pesta√±as
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Mostrar el contenido seleccionado
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        function getToken() {
            const token = document.getElementById('token').value.trim();
            if (!token) {
                alert('Por favor ingresa tu token de API');
                return null;
            }
            if (token.length !== 36) {
                alert('El token debe tener exactamente 36 caracteres');
                return null;
            }
            return token;
        }

        async function searchDestinations() {
            const token = getToken();
            if (!token) return;

            const searchTerm = document.getElementById('searchDestination').value.trim();
            const numResults = document.getElementById('numResults').value;

            if (!searchTerm) {
                alert('Por favor ingresa un t√©rmino de b√∫squeda');
                return;
            }

            try {
                const formData = new URLSearchParams({
                    buscar: searchTerm,
                    type: 'json',
                    num: numResults,
                    key: token
                });

                const response = await fetch('https://gaia.inegi.org.mx/sakbe_v3.1/buscadestino', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });

                const data = await response.json();

                const resultDiv = document.getElementById('destinationResult');
                resultDiv.style.display = 'block';
                resultDiv.textContent = JSON.stringify(data, null, 2);

            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function searchLines() {
            const token = getToken();
            if (!token) return;

            const longitude = document.getElementById('longitude').value;
            const latitude = document.getElementById('latitude').value;
            const scale = document.getElementById('scale').value;

            if (!longitude || !latitude) {
                alert('Por favor ingresa longitud y latitud');
                return;
            }

            try {
                const formData = new URLSearchParams({
                    x: longitude,
                    y: latitude,
                    escala: scale,
                    type: 'json',
                    key: token
                });

                const response = await fetch('https://gaia.inegi.org.mx/sakbe_v3.1/buscalinea', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });

                const data = await response.json();

                const resultDiv = document.getElementById('lineResult');
                resultDiv.style.display = 'block';
                resultDiv.textContent = JSON.stringify(data, null, 2);

            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function calculateRoute(routeType) 
        {
            const token = getToken();
            if (!token) return;

            const originId = document.getElementById('originDestId').value;
            const finalId = document.getElementById('finalDestId').value;
            const vehicleType = document.getElementById('vehicleType').value;
            const excessAxles = document.getElementById('excessAxles').value;
            const barriers = document.getElementById('barriers').value;

            if (!originId || !finalId) {
                alert('Por favor ingresa los IDs de origen y destino');
                return;
            }

            try {
                const formData = new URLSearchParams({
                    dest_i: originId,
                    dest_f: finalId,
                    v: vehicleType,
                    e: excessAxles,
                    type: 'json',
                    key: token
                });

                if (barriers) {
                    formData.append('b', barriers);
                }

                const response = await fetch(`https://gaia.inegi.org.mx/sakbe_v3.1/${routeType}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });
                console.log(response);
                console.dir(response);
                console.log('FormDATA:', formData.toString());

                const data = await response.json();

                const resultDiv = document.getElementById('routeResult');
                console.dir(data);
                resultDiv.style.display = 'block';

                // Formato m√°s legible para rutas
                let formattedResult = `=== RUTA ${routeType.toUpperCase()} ===\n\n`;
                if (data.data) {
                    formattedResult += `Distancia: ${data.data.long_km} km\n`;
                    formattedResult += `Tiempo: ${data.data.tiempo_min} minutos\n`;
                    formattedResult += `Costo casetas: $${data.data.costo_caseta}\n`;
                    formattedResult += `Pasa por peaje: ${data.data.peaje === 't' ? 'S√≠' : 'No'}\n`;
                    if (data.data.eje_excedente) {
                        formattedResult += `Costo ejes excedentes: $${data.data.eje_excedente}\n`;
                    }
                    if (data.data.advertencia) {
                        formattedResult += `\nAdvertencia: ${data.data.advertencia}\n`;
                    }
                }
                formattedResult += '\n' + JSON.stringify(data, null, 2);

                resultDiv.textContent = formattedResult;

            } catch (error) {
                alert('Error: ' + error.message);
            }
            
        }

















        async function getRouteDetails(detailType) {
            const token = getToken();
            if (!token) return;

            const originId = document.getElementById('originDestId').value;
            const finalId = document.getElementById('finalDestId').value;
            const vehicleType = document.getElementById('vehicleType').value;

            if (!originId || !finalId) {
                alert('Por favor ingresa los IDs de origen y destino');
                return;
            }

            try {
                const formData = new URLSearchParams({
                    dest_i: originId,
                    dest_f: finalId,
                    v: vehicleType,
                    type: 'json',
                    key: token
                });

                const response = await fetch(`https://gaia.inegi.org.mx/sakbe_v3.1/${detailType}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });
                const data = await response.json();

                const resultDiv = document.getElementById('routeResult');
                resultDiv.style.display = 'block';
                resultDiv.textContent = JSON.stringify(data, null, 2);

            } catch (error) {
                alert('Error: ' + error.message);
            }
        }


















        
        async function getFuelPrices() {
            const token = getToken();
            if (!token) return;

            try {
                const formData = new URLSearchParams({
                    type: 'json',
                    key: token
                });

                const response = await fetch('https://gaia.inegi.org.mx/sakbe_v3.1/combustible', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });

                const data = await response.json();

                const resultDiv = document.getElementById('fuelResult');
                resultDiv.style.display = 'block';

                // Formato m√°s legible para combustibles
                let formattedResult = '=== PRECIOS DE COMBUSTIBLE ===\n\n';
                if (data.data && Array.isArray(data.data)) {
                    data.data.forEach(fuel => {
                        formattedResult += `${fuel.tipo}: $${fuel.costo}\n`;
                    });
                }
                formattedResult += '\n' + JSON.stringify(data, null, 2);

                resultDiv.textContent = formattedResult;

            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
    </script>
</body>

</html>